<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName osm2cai.prod.maphub.it
        DocumentRoot "/var/www/html/osm2cai2/public"

        # Logging
        ErrorLog ${APACHE_LOG_DIR}/osm2cai.prod.maphub.it.error.log
        CustomLog ${APACHE_LOG_DIR}/osm2cai.prod.maphub.it.access.log combined

        # CORS Headers
        <IfModule mod_headers.c>
            Header always set Access-Control-Allow-Origin "*"
            Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
            Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, App-id"
            Header always set Access-Control-Allow-Credentials "true"
            
            # Gestione speciale delle richieste OPTIONS per CORS
            RewriteEngine On
            RewriteCond %{REQUEST_METHOD} OPTIONS
            RewriteRule ^(.*)$ $1 [R=200,L]
        </IfModule>

        # PHP-FPM Configuration
        <FilesMatch \.php$>
            SetHandler proxy:fcgi://localhost:9108
        </FilesMatch>

        # URL Rewriting
        RewriteEngine on
        # Some rewrite rules in this file were disabled on your HTTPS site,
        # because they have the potential to create redirection loops.

        # RewriteCond %{SERVER_NAME} =osm2cai.prod.maphub.it
        # RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]

        # SSL Configuration
        Include /etc/letsencrypt/options-ssl-apache.conf
        SSLCertificateFile /etc/letsencrypt/live/osm2cai.prod.maphub.it/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/osm2cai.prod.maphub.it/privkey.pem
    </VirtualHost>
</IfModule>