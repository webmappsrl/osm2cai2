/*! For license information please see field.js.LICENSE.txt */
(()=>{"use strict";var e,r={72:(e,r,t)=>{var o,n=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},a=function(){var e={};return function(r){if(void 0===e[r]){var t=document.querySelector(r);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}e[r]=t}return e[r]}}(),i=[];function s(e){for(var r=-1,t=0;t<i.length;t++)if(i[t].identifier===e){r=t;break}return r}function c(e,r){for(var t={},o=[],n=0;n<e.length;n++){var a=e[n],c=r.base?a[0]+r.base:a[0],d=t[c]||0,l="".concat(c," ").concat(d);t[c]=d+1;var u=s(l),f={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(i[u].references++,i[u].updater(f)):i.push({identifier:l,updater:h(f,r),references:1}),o.push(l)}return o}function d(e){var r=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var n=t.nc;n&&(o.nonce=n)}if(Object.keys(o).forEach(function(e){r.setAttribute(e,o[e])}),"function"==typeof e.insert)e.insert(r);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(r)}return r}var l,u=(l=[],function(e,r){return l[e]=r,l.filter(Boolean).join("\n")});function f(e,r,t,o){var n=t?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=u(r,n);else{var a=document.createTextNode(n),i=e.childNodes;i[r]&&e.removeChild(i[r]),i.length?e.insertBefore(a,i[r]):e.appendChild(a)}}function p(e,r,t){var o=t.css,n=t.media,a=t.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var g=null,b=0;function h(e,r){var t,o,n;if(r.singleton){var a=b++;t=g||(g=d(r)),o=f.bind(null,t,a,!1),n=f.bind(null,t,a,!0)}else t=d(r),o=p.bind(null,t,r),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)};return o(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;o(e=r)}else n()}}e.exports=function(e,r){(r=r||{}).singleton||"boolean"==typeof r.singleton||(r.singleton=n());var t=c(e=e||[],r);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<t.length;o++){var n=s(t[o]);i[n].references--}for(var a=c(e,r),d=0;d<t.length;d++){var l=s(t[d]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}t=a}}}},262:(e,r)=>{r.A=(e,r)=>{const t=e.__vccOpts||e;for(const[e,o]of r)t[e]=o;return t}},296:(e,r,t)=>{t.d(r,{A:()=>a});var o=t(314),n=t.n(o)()(function(e){return e[1]});n.push([e.id,'.signage-arrows-container[data-v-ba03e6be]{display:flex;flex-direction:column;gap:20px;padding:12px 0}.route-signage-block[data-v-ba03e6be]{display:flex;flex-direction:column;gap:12px}.signage-arrow-wrapper[data-v-ba03e6be]{display:flex;justify-content:flex-start}.signage-arrow[data-v-ba03e6be]{align-items:stretch;display:flex;filter:drop-shadow(1px 2px 3px rgba(0,0,0,.15));height:150px;max-width:400px;min-width:400px;width:400px}.signage-arrow.forward[data-v-ba03e6be]{margin-left:30px}.arrow-body[data-v-ba03e6be]{align-items:stretch;background:#fff;border:1px solid #000;display:flex;flex-grow:1;height:100%}.forward .arrow-body[data-v-ba03e6be]{border-right:none}.backward .arrow-body[data-v-ba03e6be]{border-left:none}.route-id-column[data-v-ba03e6be]{display:flex;flex-direction:column;max-width:70px;min-width:55px}.route-id-red[data-v-ba03e6be]{background:#c41e3a;flex:1}.forward .route-id-red[data-v-ba03e6be]{border-right:1px solid #000}.backward .route-id-red[data-v-ba03e6be]{border-left:1px solid #000}.route-id-box[data-v-ba03e6be]{align-items:center;background:#fff;border:1px solid #000;color:#000;display:flex;flex:1;font-family:Arial,sans-serif;font-size:20px;font-weight:700;justify-content:center;overflow:hidden;padding:6px 14px;text-overflow:ellipsis;white-space:nowrap}.forward .route-id-box[data-v-ba03e6be]{border-left:none}.backward .route-id-column[data-v-ba03e6be]{order:2}.backward .route-id-box[data-v-ba03e6be]{border-right:none}.backward .destinations-list[data-v-ba03e6be]{order:1}.destinations-list[data-v-ba03e6be]{display:flex;flex-direction:column;flex-grow:1;min-height:100%;padding:4px 0}.destinations-list[data-v-ba03e6be],.destinations-list--single[data-v-ba03e6be]{justify-content:center}.destination-row[data-v-ba03e6be]{align-items:center;display:flex;flex:1;gap:30px;justify-content:space-between;padding:2px 16px;position:relative}.destination-row--with-separator[data-v-ba03e6be]:after{border-bottom:1px solid #000;bottom:0;content:"";left:16px;position:absolute;right:0}.forward .destination-row--with-separator[data-v-ba03e6be]:after{left:16px;right:0}.backward .destination-row--with-separator[data-v-ba03e6be]:after{left:0;right:16px}.destination-info[data-v-ba03e6be]{align-items:flex-start;display:flex;flex:1;flex-direction:column;gap:4px;max-width:180px;min-width:0}.destination-name[data-v-ba03e6be]{color:#000;font-size:15px;font-weight:600}.destination-description[data-v-ba03e6be],.destination-name[data-v-ba03e6be]{font-family:Arial,sans-serif;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.destination-description[data-v-ba03e6be]{color:#666;font-size:10px;font-weight:400;line-height:1.2}.destination-distance[data-v-ba03e6be],.destination-time[data-v-ba03e6be]{color:#000;font-family:Arial,sans-serif;font-size:13px;font-weight:700}.destination-time[data-v-ba03e6be]{min-width:55px;text-align:right}.destination-meta[data-v-ba03e6be]{align-items:flex-end;display:flex;flex-direction:column;gap:2px}.arrow-point-right[data-v-ba03e6be]{clip-path:polygon(0 0,0 100%,100% 50%)}.arrow-point-left[data-v-ba03e6be],.arrow-point-right[data-v-ba03e6be]{align-self:stretch;background:#c41e3a;min-width:30px;width:30px}.arrow-point-left[data-v-ba03e6be]{clip-path:polygon(100% 0,100% 100%,0 50%)}.no-signage-data[data-v-ba03e6be]{color:#6b7280;font-style:italic;padding:16px;text-align:center}.arrow-direction-control[data-v-ba03e6be]{left:-48px;position:absolute;top:50%;transform:translateY(-50%);z-index:10}.arrow-direction-btn[data-v-ba03e6be]{align-items:center;background:#3490dc;border:none;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2);color:#fff;cursor:pointer;display:flex;height:28px;justify-content:center;padding:0;transition:all .2s;width:28px}.arrow-direction-btn[data-v-ba03e6be]:hover{background:#2779bd;transform:scale(1.1)}.arrow-direction-btn[data-v-ba03e6be]:active{background:#1c6ca8;transform:scale(.95)}.arrow-direction-btn svg[data-v-ba03e6be]{height:14px;width:14px}.signage-arrow-wrapper[data-v-ba03e6be]{position:relative}.arrow-order-controls[data-v-ba03e6be]{display:flex;flex-direction:column;gap:6px;position:absolute;right:-48px;top:50%;transform:translateY(-50%);z-index:10}.arrow-order-btn[data-v-ba03e6be]{background:#f3f4f6;border:1px solid #d1d5db;border-radius:6px;color:#111827;cursor:pointer;font-size:12px;height:26px;line-height:1;transition:background .15s ease,transform .15s ease;width:26px}.arrow-order-btn[data-v-ba03e6be]:hover:enabled{background:#e5e7eb;transform:translateY(-1px)}.arrow-order-btn[data-v-ba03e6be]:disabled{cursor:not-allowed;opacity:.5}.confirm-modal-overlay[data-v-ba03e6be]{align-items:center;background:rgba(0,0,0,.5);bottom:0;display:flex;justify-content:center;left:0;position:fixed;right:0;top:0;z-index:1000}.confirm-modal[data-v-ba03e6be]{background:#fff;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.1),0 2px 4px rgba(0,0,0,.06);max-width:500px;overflow:hidden;width:90%}.confirm-modal-header[data-v-ba03e6be]{border-bottom:1px solid #e5e7eb;padding:20px 24px}.confirm-modal-header h3[data-v-ba03e6be]{color:#111827;font-family:Arial,sans-serif;font-size:18px;font-weight:600;margin:0}.confirm-modal-body[data-v-ba03e6be]{padding:24px}.confirm-modal-body p[data-v-ba03e6be]{color:#374151;font-family:Arial,sans-serif;font-size:14px;line-height:1.5;margin:0}.confirm-modal-footer[data-v-ba03e6be]{border-top:1px solid #e5e7eb;display:flex;gap:12px;justify-content:flex-end;padding:16px 24px}.confirm-btn[data-v-ba03e6be]{border:1px solid transparent;border-radius:6px;cursor:pointer;font-family:Arial,sans-serif;font-size:14px;font-weight:500;padding:8px 16px;transition:all .2s}.confirm-btn--cancel[data-v-ba03e6be]{background:#fff;border-color:#d1d5db;color:#374151}.confirm-btn--cancel[data-v-ba03e6be]:hover{background:#f9fafb;border-color:#9ca3af}.confirm-btn--confirm[data-v-ba03e6be]{background:#3490dc;border-color:#3490dc;color:#fff}.confirm-btn--confirm[data-v-ba03e6be]:hover{background:#2779bd;border-color:#2779bd}.confirm-btn[data-v-ba03e6be]:active{transform:scale(.98)}',""]);const a=n},314:e=>{e.exports=function(e){var r=[];return r.toString=function(){return this.map(function(r){var t=e(r);return r[2]?"@media ".concat(r[2]," {").concat(t,"}"):t}).join("")},r.i=function(e,t,o){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(o)for(var a=0;a<this.length;a++){var i=this[a][0];null!=i&&(n[i]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);o&&n[c[0]]||(t&&(c[2]?c[2]="".concat(t," and ").concat(c[2]):c[2]=t),r.push(c))}},r}},613:()=>{},824:(e,r,t)=>{const o=Vue;function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(e){if("string"==typeof e)return a(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=Array(r);t<r;t++)o[t]=e[t];return o}var i={class:"signage-arrows-container"},s={key:0,class:"signage-arrow-wrapper"},c={class:"arrow-order-controls"},d=["disabled","onClick"],l=["disabled","onClick"],u={class:"arrow-direction-control"},f=["onClick","title"],p={key:0,class:"arrow-point-left"},g={class:"arrow-body"},b={class:"route-id-column"},h={class:"route-id-box"},m={class:"destination-info"},w={class:"destination-name"},v={key:0,class:"destination-description"},y={class:"destination-meta"},x={class:"destination-time"},A={key:0,class:"destination-distance"},D={key:1,class:"arrow-point-right"},S={key:0,class:"no-signage-data"},k={class:"confirm-modal"},I={class:"confirm-modal-body"},O={class:"confirm-modal-footer"};function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function N(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function j(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?N(Object(t),!0).forEach(function(r){E(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):N(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function E(e,r,t){return(r=function(e){var r=function(e,r){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,r||"default");if("object"!=C(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==C(r)?r:r+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function T(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,n,a,i,s=[],c=!0,d=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(o=a.call(t)).done)&&(s.push(o.value),s.length!==r);c=!0);}catch(e){d=!0,n=e}finally{try{if(!c&&null!=t.return&&(i=t.return(),Object(i)!==i))return}finally{if(d)throw n}}return s}}(e,r)||B(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||B(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,r){if(e){if("string"==typeof e)return M(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?M(e,r):void 0}}function M(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=Array(r);t<r;t++)o[t]=e[t];return o}const P={name:"SignageArrowsDisplay",props:{signageData:{type:Object,default:function(){return{}}}},computed:{confirmModalMessage:function(){return this.pendingAction?"toggle"===this.pendingAction.type?"Sei sicuro di voler invertire la direzione della freccia?":"move"===this.pendingAction.type?"Sei sicuro di voler spostare questa freccia?":"Sei sicuro di voler eseguire questa operazione?":""},processedSignageData:function(){var e=this;if(!this.signageData||0===Object.keys(this.signageData).length)return{};var r=this.signageData,t=[],o=this.localArrowOrder&&this.localArrowOrder.length>0?this.localArrowOrder:[];this.signageData.signage&&(r=this.signageData.signage),r.arrow_order&&Array.isArray(r.arrow_order)&&(t=r.arrow_order,0===o.length&&o.push.apply(o,_(t)));for(var n={},a=function(){var r=T(s[i],2),a=r[0],c=r[1];if("arrow_order"===a)return 1;var d=a,l=c;if(l.arrows&&Array.isArray(l.arrows)){var u=[],f=(o.length>0?o:t).filter(function(e){return e&&e.startsWith("".concat(d,"-"))});if(f.length>0){var p,g=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=B(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw a}}}}(f);try{for(g.s();!(p=g.n()).done;){var b=T(p.value.split("-"),2),h=b[0],m=b[1];if(h===d){var w=parseInt(m,10),v=l.arrows[w];!isNaN(w)&&v&&v.rows&&Array.isArray(v.rows)&&u.push(j(j({},v),{},{__arrowKey:"".concat(d,"-").concat(w)}))}}}catch(e){g.e(e)}finally{g.f()}}for(var y=function(){var e=l.arrows[x],r="".concat(d,"-").concat(x);e&&e.rows&&Array.isArray(e.rows)&&(u.some(function(e){return e.__arrowKey===r})||u.push(j(j({},e),{},{__arrowKey:r})))},x=0;x<l.arrows.length;x++)y();var A=(u||[]).filter(function(e){return e&&"object"===C(e)&&e.rows&&Array.isArray(e.rows)&&e.rows.length>0});if(A.length>0){var D=A.map(function(r,t){var o="".concat(d,"-").concat(t),n=r.__arrowKey||o,a=e.localArrowDirections[n];return j(j({},r),{},{__arrowKey:n,direction:a||r.direction})});n[d]={ref:l.ref||"",orderedArrows:D}}}else if(l.forward||l.backward){var S=[];l.forward&&Array.isArray(l.forward)&&l.forward.length>0&&S.push({direction:"forward",rows:l.forward}),l.backward&&Array.isArray(l.backward)&&l.backward.length>0&&S.push({direction:"backward",rows:l.backward}),S.length>0&&(n[d]={ref:l.ref||"",orderedArrows:S})}},i=0,s=Object.entries(r);i<s.length;i++)a();return n},hasSignageData:function(){return Object.keys(this.processedSignageData).length>0}},data:function(){return{localArrowDirections:{},localArrowOrder:[],showConfirmModal:!1,pendingAction:null}},methods:{getArrowDirection:function(e,r,t){var o,n=this.processedSignageData[e],a=(null==n||null===(o=n.orderedArrows)||void 0===o||null===(o=o[r])||void 0===o?void 0:o.__arrowKey)||"".concat(e,"-").concat(r);return this.localArrowDirections[a]||t},toggleArrowDirection:function(e,r){var t=this.processedSignageData[e];t&&t.orderedArrows&&t.orderedArrows[r]&&(this.pendingAction={type:"toggle",params:{routeId:e,arrowIdx:r}},this.showConfirmModal=!0)},executeToggleArrowDirection:function(e,r){var t;fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDisplay.vue:executeToggleArrowDirection",message:"Metodo chiamato",data:{routeId:e,arrowIdx:r},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(function(){});var o=this.processedSignageData[e];if(o&&o.orderedArrows&&o.orderedArrows[r]){var n=o.orderedArrows[r],a=n.__arrowKey||"".concat(e,"-").concat(r),i=this.getArrowDirection(e,r,n.direction),s="forward"===i?"backward":"forward";fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDisplay.vue:executeToggleArrowDirection",message:"Calcolata nuova direzione",data:{routeId:e,arrowIdx:r,currentDirection:i,newDirection:s},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(function(){}),this.localArrowDirections=j(j({},this.localArrowDirections),{},E({},a,s));var c=this.signageData;this.signageData.signage&&(c=this.signageData.signage);var d=c[e],l=parseInt(null!==(t=a.split("-")[1])&&void 0!==t?t:r,10);d&&d.arrows&&d.arrows[l]&&(d.arrows[l].direction=s),fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDisplay.vue:executeToggleArrowDirection",message:"Prima di emettere evento",data:{routeId:e,arrowIdx:r,newDirection:s},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(function(){}),this.$emit("arrow-direction-changed",{routeId:e,arrowIndex:l,newDirection:s,fullSignageData:this.signageData}),fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDisplay.vue:executeToggleArrowDirection",message:"Evento emesso",data:{routeId:e,arrowIdx:r,newDirection:s},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(function(){})}else fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDisplay.vue:executeToggleArrowDirection",message:"Route data non valida",data:{routeId:e,arrowIdx:r,hasRouteData:!!o,hasOrderedArrows:!(!o||!o.orderedArrows)},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"G"})}).catch(function(){})},formatTime:function(e){if(!e&&0!==e)return"-";var r=Math.floor(e/60),t=e%60;return 0===r?"0:".concat(t.toString().padStart(2,"0")):"".concat(r,":").concat(t.toString().padStart(2,"0"))},formatDistance:function(e){return e||0===e?(e/1e3).toFixed(1).replace(".",","):""},formatDestinationName:function(e){return console.log("destination",e),e&&"object"===C(e)?e.name?e.name:e.ref||e.tooltip?"ref: "+e.ref||0:"id: "+e.id:"-"},getCurrentOrder:function(){if(this.localArrowOrder&&this.localArrowOrder.length>0)return _(this.localArrowOrder);var e=this.signageData;return this.signageData.signage&&(e=this.signageData.signage),e.arrow_order&&Array.isArray(e.arrow_order)?_(e.arrow_order):[]},canMoveUp:function(e,r){var t=this.processedSignageData[e];if(!t||!t.orderedArrows)return!1;var o=t.orderedArrows[r];return!(!o||!o.__arrowKey)&&this.getCurrentOrder().filter(function(r){return r.startsWith("".concat(e,"-"))}).indexOf(o.__arrowKey)>0},canMoveDown:function(e,r){var t=this.processedSignageData[e];if(!t||!t.orderedArrows)return!1;var o=t.orderedArrows[r];if(!o||!o.__arrowKey)return!1;var n=this.getCurrentOrder().filter(function(r){return r.startsWith("".concat(e,"-"))}),a=n.indexOf(o.__arrowKey);return-1!==a&&a<n.length-1},moveArrow:function(e,r,t){var o=this.processedSignageData[e];if(o&&o.orderedArrows){var n=o.orderedArrows[r];n&&n.__arrowKey&&(this.pendingAction={type:"move",params:{routeId:e,arrowIdx:r,direction:t}},this.showConfirmModal=!0)}},executeMoveArrow:function(e,r,t){var o=this.processedSignageData[e];if(o&&o.orderedArrows){var n=o.orderedArrows[r];if(n&&n.__arrowKey){var a=this.getCurrentOrder();if(0===a.length){var i=o.orderedArrows.map(function(e){return e.__arrowKey});a.push.apply(a,_(i))}var s=a.filter(function(r){return r.startsWith("".concat(e,"-"))}),c=s.indexOf(n.__arrowKey);if(-1!==c){var d="up"===t?c-1:c+1;if(!(d<0||d>=s.length)){var l=[s[d],s[c]];s[c]=l[0],s[d]=l[1];var u=0,f=a.map(function(r){return r.startsWith("".concat(e,"-"))?s[u++]:r});u<s.length&&f.push.apply(f,_(s.slice(u))),this.localArrowOrder=f,this.$emit("arrow-order-changed",{routeId:e,arrowOrder:f,fullSignageData:this.signageData})}}}}},executeConfirmedAction:function(){if(this.pendingAction){var e=this.pendingAction,r=e.type,t=e.params;"toggle"===r?this.executeToggleArrowDirection(t.routeId,t.arrowIdx):"move"===r&&this.executeMoveArrow(t.routeId,t.arrowIdx,t.direction),this.closeConfirmModal()}else this.closeConfirmModal()},closeConfirmModal:function(){this.showConfirmModal=!1,this.pendingAction=null}}};var V=t(72),F=t.n(V),z=t(296),K={insert:"head",singleton:!1};F()(z.A,K);z.A.locals;var J=t(262);function G(){var e,r,t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",n=t.toStringTag||"@@toStringTag";function a(t,o,n,a){var c=o&&o.prototype instanceof s?o:s,d=Object.create(c.prototype);return q(d,"_invoke",function(t,o,n){var a,s,c,d=0,l=n||[],u=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(r,t){return a=r,s=0,c=e,f.n=t,i}};function p(t,o){for(s=t,c=o,r=0;!u&&d&&!n&&r<l.length;r++){var n,a=l[r],p=f.p,g=a[2];t>3?(n=g===o)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=t<2&&p<a[1])?(s=0,f.v=o,f.n=a[1]):p<g&&(n=t<3||a[0]>o||o>g)&&(a[4]=t,a[5]=o,f.n=g,s=0))}if(n||t>1)return i;throw u=!0,o}return function(n,l,g){if(d>1)throw TypeError("Generator is already running");for(u&&1===l&&p(l,g),s=l,c=g;(r=s<2?e:c)||!u;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(d=2,a){if(s||(n="next"),r=a[n]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,s<2&&(s=0)}else 1===s&&(r=a.return)&&r.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+n+"' method"),s=1);a=e}else if((r=(u=f.n<0)?c:t.call(o,f))!==i)break}catch(r){a=e,s=1,c=r}finally{d=1}}return{value:r,done:u}}}(t,n,a),!0),d}var i={};function s(){}function c(){}function d(){}r=Object.getPrototypeOf;var l=[][o]?r(r([][o]())):(q(r={},o,function(){return this}),r),u=d.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,q(e,n,"GeneratorFunction")),e.prototype=Object.create(u),e}return c.prototype=d,q(u,"constructor",d),q(d,"constructor",c),c.displayName="GeneratorFunction",q(d,n,"GeneratorFunction"),q(u),q(u,n,"Generator"),q(u,o,function(){return this}),q(u,"toString",function(){return"[object Generator]"}),(G=function(){return{w:a,m:f}})()}function q(e,r,t,o){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}q=function(e,r,t,o){function a(r,t){q(e,r,function(e){return this._invoke(r,t,e)})}r?n?n(e,r,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[r]=t:(a("next",0),a("throw",1),a("return",2))},q(e,r,t,o)}function L(e,r,t,o,n,a,i){try{var s=e[a](i),c=s.value}catch(e){return void t(e)}s.done?r(c):Promise.resolve(c).then(o,n)}function R(e){return function(){var r=this,t=arguments;return new Promise(function(o,n){var a=e.apply(r,t);function i(e){L(a,o,n,i,s,"next",e)}function s(e){L(a,o,n,i,s,"throw",e)}i(void 0)})}}const U={name:"SignageArrowsDetailField",components:{SignageArrowsDisplay:(0,J.A)(P,[["render",function(e,r,t,a,C,N){return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(N.processedSignageData,function(e,t){return(0,o.openBlock)(),(0,o.createElementBlock)("div",{key:t,class:"route-signage-block"},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.orderedArrows||[],function(a,i){return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:i},[a&&a.rows&&Array.isArray(a.rows)&&a.rows.length>0?((0,o.openBlock)(),(0,o.createElementBlock)("div",s,[(0,o.createElementVNode)("div",c,[(0,o.createElementVNode)("button",{class:"arrow-order-btn",disabled:!N.canMoveUp(t,i),onClick:function(e){return N.moveArrow(t,i,"up")},title:"Sposta su"}," ▲ ",8,d),(0,o.createElementVNode)("button",{class:"arrow-order-btn",disabled:!N.canMoveDown(t,i),onClick:function(e){return N.moveArrow(t,i,"down")},title:"Sposta giù"}," ▼ ",8,l)]),(0,o.createElementVNode)("div",u,[(0,o.createElementVNode)("button",{onClick:function(e){return N.toggleArrowDirection(t,i)},class:"arrow-direction-btn",title:"Inverti direzione: ".concat("forward"===a.direction?"forward → backward":"backward → forward")},n(r[3]||(r[3]=[(0,o.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,o.createElementVNode)("path",{d:"M3 12h18M3 12l4-4m-4 4l4 4M21 12l-4-4m4 4l-4 4"})],-1)])),8,f)]),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["signage-arrow",N.getArrowDirection(t,i,a.direction)])},["backward"===N.getArrowDirection(t,i,a.direction)?((0,o.openBlock)(),(0,o.createElementBlock)("div",p)):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",g,[(0,o.createElementVNode)("div",b,[r[4]||(r[4]=(0,o.createElementVNode)("div",{class:"route-id-red"},null,-1)),(0,o.createElementVNode)("div",h,(0,o.toDisplayString)(null==e?void 0:e.ref),1),r[5]||(r[5]=(0,o.createElementVNode)("div",{class:"route-id-red"},null,-1))]),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["destinations-list",{"destinations-list--single":1===(a.rows||[]).length}])},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(a.rows,function(e,r){return(0,o.openBlock)(),(0,o.createElementBlock)("div",{key:r,class:(0,o.normalizeClass)(["destination-row",{"destination-row--with-separator":r<a.rows.length-1}])},[(0,o.createElementVNode)("span",m,[(0,o.createElementVNode)("span",w,(0,o.toDisplayString)(N.formatDestinationName(e)),1),null!=e&&e.description?((0,o.openBlock)(),(0,o.createElementBlock)("span",v,(0,o.toDisplayString)(null==e?void 0:e.description),1)):(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("span",y,[(0,o.createElementVNode)("span",x,"h "+(0,o.toDisplayString)(N.formatTime(null==e?void 0:e.time_hiking)),1),null!=e&&e.distance?((0,o.openBlock)(),(0,o.createElementBlock)("span",A," km "+(0,o.toDisplayString)(N.formatDistance(null==e?void 0:e.distance)),1)):(0,o.createCommentVNode)("",!0)])],2)}),128))],2)]),"forward"===N.getArrowDirection(t,i,a.direction)?((0,o.openBlock)(),(0,o.createElementBlock)("div",D)):(0,o.createCommentVNode)("",!0)],2)])):(0,o.createCommentVNode)("",!0)],64)}),128))])}),128)),N.hasSignageData?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)("div",S," Nessun dato segnaletica disponibile ")),C.showConfirmModal?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:1,class:"confirm-modal-overlay",onClick:r[2]||(r[2]=(0,o.withModifiers)(function(){return N.closeConfirmModal&&N.closeConfirmModal.apply(N,arguments)},["self"]))},[(0,o.createElementVNode)("div",k,[r[6]||(r[6]=(0,o.createElementVNode)("div",{class:"confirm-modal-header"},[(0,o.createElementVNode)("h3",null,"Conferma operazione")],-1)),(0,o.createElementVNode)("div",I,[(0,o.createElementVNode)("p",null,(0,o.toDisplayString)(N.confirmModalMessage),1)]),(0,o.createElementVNode)("div",O,[(0,o.createElementVNode)("button",{class:"confirm-btn confirm-btn--cancel",onClick:r[0]||(r[0]=function(){return N.closeConfirmModal&&N.closeConfirmModal.apply(N,arguments)})}," Annulla "),(0,o.createElementVNode)("button",{class:"confirm-btn confirm-btn--confirm",onClick:r[1]||(r[1]=function(){return N.executeConfirmedAction&&N.executeConfirmedAction.apply(N,arguments)})}," Conferma ")])])])):(0,o.createCommentVNode)("",!0)])}],["__scopeId","data-v-ba03e6be"]])},props:["index","resource","resourceName","resourceId","field"],data:function(){return{localSignageData:null}},computed:{signageData:function(){return this.localSignageData||this.field.value||{}}},methods:{handleArrowDirectionChanged:function(e){var r=this;return R(G().m(function t(){var o,n,a,i,s,c;return G().w(function(t){for(;;)switch(t.p=t.n){case 0:if(fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowDirectionChanged",message:"Evento arrow-direction-changed ricevuto",data:{routeId:e.routeId,arrowIndex:e.arrowIndex,newDirection:e.newDirection,resourceId:r.resourceId,resourceName:r.resourceName},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){}),"poles"!==r.resourceName||!r.resourceId){t.n=5;break}return t.p=1,a=parseInt(r.resourceId),fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowDirectionChanged",message:"Chiamata API per salvare direzione (Pole)",data:{poleId:a,routeId:e.routeId,arrowIndex:e.arrowIndex,newDirection:e.newDirection},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){}),t.n=2,Nova.request().patch("/nova-vendor/signage-map/pole/".concat(a,"/arrow-direction"),{routeId:e.routeId,arrowIndex:e.arrowIndex,newDirection:e.newDirection});case 2:i=t.v,fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowDirectionChanged",message:"Risposta API ricevuta (Pole)",data:{success:null===(o=i.data)||void 0===o?void 0:o.success,status:i.status},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){}),null!==(n=i.data)&&void 0!==n&&n.signageData&&(r.localSignageData=i.data.signageData,fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowDirectionChanged",message:"localSignageData aggiornato",data:{hasData:!!r.localSignageData},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){})),Nova.success("Direzione freccia aggiornata con successo"),t.n=4;break;case 3:t.p=3,c=t.v,fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowDirectionChanged",message:"Errore durante salvataggio (Pole)",data:{error:c.message,status:null===(s=c.response)||void 0===s?void 0:s.status},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){}),console.error("Errore durante il salvataggio della direzione:",c),Nova.error("Errore durante il salvataggio della direzione");case 4:t.n=6;break;case 5:fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowDirectionChanged",message:"Resource non supportato per salvataggio",data:{resourceName:r.resourceName,resourceId:r.resourceId},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){}),console.warn("Salvataggio direzione non supportato per questa risorsa:",r.resourceName);case 6:return t.a(2)}},t,null,[[1,3]])}))()},handleArrowOrderChanged:function(e){var r=this;return R(G().m(function t(){var o,n,a,i;return G().w(function(t){for(;;)switch(t.p=t.n){case 0:if(fetch("http://127.0.0.1:7243/ingest/d698a848-ad0a-4be9-8feb-9586ee30a5c3",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"SignageArrowsDetailField.vue:handleArrowOrderChanged",message:"Evento arrow-order-changed ricevuto",data:{routeId:e.routeId,resourceId:r.resourceId,resourceName:r.resourceName},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"F"})}).catch(function(){}),"poles"!==r.resourceName||!r.resourceId){t.n=5;break}return t.p=1,n=parseInt(r.resourceId),t.n=2,Nova.request().patch("/nova-vendor/signage-map/pole/".concat(n,"/arrow-order"),{routeId:e.routeId,arrowOrder:e.arrowOrder});case 2:a=t.v,null!==(o=a.data)&&void 0!==o&&o.signageData&&(r.localSignageData=a.data.signageData),Nova.success("Ordine frecce aggiornato con successo"),t.n=4;break;case 3:t.p=3,i=t.v,console.error("Errore durante il salvataggio dell'ordine frecce:",i),Nova.error("Errore durante il salvataggio dell'ordine frecce");case 4:t.n=6;break;case 5:console.warn("Salvataggio ordine non supportato per questa risorsa:",r.resourceName);case 6:return t.a(2)}},t,null,[[1,3]])}))()}}},W=(0,J.A)(U,[["render",function(e,r,t,n,a,i){var s=(0,o.resolveComponent)("SignageArrowsDisplay"),c=(0,o.resolveComponent)("PanelItem");return(0,o.openBlock)(),(0,o.createBlock)(c,{index:t.index,field:t.field},{value:(0,o.withCtx)(function(){return[(0,o.createVNode)(s,{"signage-data":i.signageData,onArrowDirectionChanged:i.handleArrowDirectionChanged,onArrowOrderChanged:i.handleArrowOrderChanged},null,8,["signage-data","onArrowDirectionChanged","onArrowOrderChanged"])]}),_:1},8,["index","field"])}]]);const $={name:"SignageArrowsFormField",props:["field","resourceName","resourceId"]},Y=(0,J.A)($,[["render",function(e,r,t,n,a,i){return(0,o.openBlock)(),(0,o.createElementBlock)("div")}]]);var H={class:"text-gray-500 italic text-sm"};const Q={name:"SignageArrowsIndexField",props:["resourceName","resourceId","field"],computed:{arrowsCount:function(){var e=this.field.value||{},r=0;return Object.values(e).forEach(function(e){e.forward&&(r+=e.forward.length),e.backward&&(r+=e.backward.length)}),r}}},X=(0,J.A)(Q,[["render",function(e,r,t,n,a,i){return(0,o.openBlock)(),(0,o.createElementBlock)("span",H,(0,o.toDisplayString)(i.arrowsCount)+" frecce ",1)}]]);Nova.booting(function(e){e.component("detail-signage-arrows",W),e.component("form-signage-arrows",Y),e.component("index-signage-arrows",X)})}},t={};function o(e){var n=t[e];if(void 0!==n)return n.exports;var a=t[e]={id:e,exports:{}};return r[e](a,a.exports,o),a.exports}o.m=r,e=[],o.O=(r,t,n,a)=>{if(!t){var i=1/0;for(l=0;l<e.length;l++){for(var[t,n,a]=e[l],s=!0,c=0;c<t.length;c++)(!1&a||i>=a)&&Object.keys(o.O).every(e=>o.O[e](t[c]))?t.splice(c--,1):(s=!1,a<i&&(i=a));if(s){e.splice(l--,1);var d=n();void 0!==d&&(r=d)}}return r}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[t,n,a]},o.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return o.d(r,{a:r}),r},o.d=(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={222:0,101:0};o.O.j=r=>0===e[r];var r=(r,t)=>{var n,a,[i,s,c]=t,d=0;if(i.some(r=>0!==e[r])){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(c)var l=c(o)}for(r&&r(t);d<i.length;d++)a=i[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(l)},t=self.webpackChunk=self.webpackChunk||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})(),o.nc=void 0,o.O(void 0,[101],()=>o(824));var n=o.O(void 0,[101],()=>o(613));n=o.O(n)})();